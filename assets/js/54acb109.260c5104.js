(self.webpackChunk_2024msi_presentation=self.webpackChunk_2024msi_presentation||[]).push([[6e3],{96347:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>cr,contentTitle:()=>lr,default:()=>fr,frontMatter:()=>ar,metadata:()=>sr,toc:()=>ur});var r=n(85893),i=n(11151),o=n(74866),a=n(85162),l=n(67294),s=n(57940);function c(e){return e`# Ptychography Helper Functions`}function u(e){return e.html`<hr class="hideable-md">`}function _(e){return e("https://cdn.jsdelivr.net/gh/nicolaspanel/numjs@0.16/dist/numjs.min.js")}function f(e){return e("https://bundle.run/ndarray-ops@1.2.2")}function d(e){return e("https://bundle.run/ndarray-complex@1.0.3")}function p(e,t){return function(n,r){let i=e.zeros(n.shape);return t.atan2(i.selection,n.selection,r.selection),i}}function v(e,t){return function(n,r){let i=e.zeros(n.shape);return t.lts(i.selection,n.selection,r),t.bandseq(i.selection,1),i}}function h(e,t,n){return class r{constructor(t){this.shape=t;let n=t.slice();n.push(2),this.data=e.zeros(n),this._nulls=new Array(t.length).fill(null)}re(){return this.data.pick(...this._nulls,0)}im(){return this.data.pick(...this._nulls,1)}abs(){return e.sqrt(this.abs_sqr())}abs_sqr(){return e.add(this.re().multiply(this.re()),this.im().multiply(this.im()))}angle(){return t(this.im(),this.re())}clone(){let e=new r(this.shape);return e.data=this.data.clone(),e}conjugate(){let t=this.re().clone(),i=this.im().clone();n.conjeq(t.selection,i.selection);let o=new r(this.shape);return o.data=e.stack([t,i],-1),o}multiply(t){let i=this.re().clone(),o=this.im().clone(),a=t.re(),l=t.im();n.muleq(i.selection,o.selection,a.selection,l.selection);let s=new r(this.shape);return s.data=e.stack([i,o],-1),s}real_multiply(t){let i=this.re().clone(),o=this.im().clone(),a=t,l=e.zeros(t.shape);n.muleq(i.selection,o.selection,a.selection,l.selection);let s=new r(this.shape);return s.data=e.stack([i,o],-1),s}scalar_multiply(t,i){let o=this.re().clone(),a=this.im().clone();n.mulseq(o.selection,a.selection,t,i);let l=new r(this.shape);return l.data=e.stack([o,a],-1),l}add(t){let i=this.re().clone(),o=this.im().clone(),a=t.re(),l=t.im();n.addeq(i.selection,o.selection,a.selection,l.selection);let s=new r(this.shape);return s.data=e.stack([i,o],-1),s}subtract(t){let i=this.re().clone(),o=this.im().clone(),a=t.re(),l=t.im();n.subeq(i.selection,o.selection,a.selection,l.selection);let s=new r(this.shape);return s.data=e.stack([i,o],-1),s}}}function m(e){return function(t,n){let r=e.zeros(t),i=1/(t*n),o=1+((t-1)/2|0);for(var a=0;a<o;a++)r.set(a,a*i);for(a=o;a<t;a++)r.set(a,(a-t)*i);return r}}function b(e){return function(t,n){let r=[t.size,n.size],i=[];i[0]=e.zeros(r),i[1]=e.zeros(r);for(let e=0;e<r[1];e++)for(let o=0;o<r[0];o++)i[0].set(o,e,t.get(o)),i[1].set(o,e,n.get(e));return i}}function g(e){return function(t){let[n,r]=t.shape,i=n/2|0,o=r/2|0,a=e.zeros([n,r]);return a.slice([null,i],[null,o]).assign(t.slice(-i,-o),!1),a.slice([null,i],o).assign(t.slice(-i,[null,o]),!1),a.slice(-i,-o).assign(t.slice([null,i],[null,o]),!1),a.slice(-i,[null,o]).assign(t.slice([null,i],-o),!1),a}}function x(e,t,n,r){return function(i,o){let[a,l]=i.shape,[s,c]=o,u=new e([a,l]);u.data=t.fft(i.data);let _=n(a,1),f=n(l,1),[d,p]=r(_,f),v=-2*Math.PI,h=t.add(d.multiply(s),p.multiply(c)).multiply(v),m=new e([a,l]),b=t.cos(h),g=t.sin(h);m.data=t.stack([b,g],-1);let x=u.multiply(m);return x.data=t.ifft(x.data),x}}function w(e){return function(t,n){let[r,i]=n,o=new e([r,i]),a=r/2|0,l=i/2|0;return o.data.slice([null,a],[null,l],null).assign(t.slice([null,a],[null,l],null),!1),o.data.slice(-a,[null,l],null).assign(t.slice(-a,[null,l],null),!1),o.data.slice([null,a],-l,null).assign(t.slice([null,a],-l,null),!1),o.data.slice(-a,-l,null).assign(t.slice(-a,-l,null),!1),o}}function j(e,t,n){return function(r,i){let[o,a]=r.shape;console.log(o);let l=new e([o,a]);l.data=t.fft(r.data);let[s,c]=[o/i|0,a/i|0],u=n(l.data,[s,c]);return u.data=t.ifft(u.data),u}}function y(){return function(e){let t=9.109383*1e-30,n=1602177e-24,r=299792458;return 662607e-39/Math.sqrt(2*t*n*e)/Math.sqrt(1+n*e/2/t/r/r)*1e11}}function k(e){return function(t){let n=9.109383*1e-30,r=1602177e-24,i=299792458,o=e(t);return 2*Math.PI/o/t*(n*i*i+r*t)/(2*n*i*i+r*t)}}function A(e,t,n,r,i,o,a){return class{constructor(t,n,r,i,o){this._gpts=t.slice(),this._sampling=n.slice(),this._energy=r,this._wavelength=e(r),this._semiangle_cutoff=i,this._defocus=o}_get_scattering_angles(){let e=t(this._gpts[0],this._sampling[0]),o=t(this._gpts[1],this._sampling[1]),[a,l]=n(e,o);return[r.sqrt(r.add(a.multiply(a.multiply(this._wavelength*this._wavelength)),l.multiply(l.multiply(this._wavelength*this._wavelength)))),i(a,l)]}_evaluate_aberrations(e,t){let n=this._defocus/this._wavelength*Math.PI,i=e.multiply(e).multiply(n),a=r.cos(i),l=r.sin(i),s=new o(i.shape);return s.data=r.stack([a,l],-1),s}_evaluate_aperture(e,t){let n=this._semiangle_cutoff/1e3,i=new o(e.shape),l=a(e,n);return i.data=r.stack([l,r.zeros(e.shape)],-1),i}build(){let[e,t]=this._get_scattering_angles(),n=this._evaluate_aberrations(e,t),i=this._evaluate_aperture(e,t),a=n.multiply(i);this._fourier_array=a;let l=new o(a.shape);l.data=r.ifft(a.data);let s=Math.sqrt(l.abs_sqr().sum());return this._array=l.scalar_multiply(1/s,0),this}}}function P(e){return e`https://observablehq.com/@mootari/notebook-data`}function R(e,t){const n=e.module();return n.variable(t()).define(["md"],c),n.variable(t()).define(["htl"],u),n.variable(t("nj")).define("nj",["require"],_),n.variable(t("ops")).define("ops",["require"],f),n.variable(t("cops")).define("cops",["require"],d),n.variable(t("atan2")).define("atan2",["nj","ops"],p),n.variable(t("lt_int_s")).define("lt_int_s",["nj","ops"],v),n.variable(t("ComplexNDArray")).define("ComplexNDArray",["nj","atan2","cops"],h),n.variable(t("fftfreq")).define("fftfreq",["nj"],m),n.variable(t("meshgrid2D")).define("meshgrid2D",["nj"],b),n.variable(t("fftshift2D")).define("fftshift2D",["nj"],g),n.variable(t("fourier_shift")).define("fourier_shift",["ComplexNDArray","nj","fftfreq","meshgrid2D"],x),n.variable(t("corner_crop")).define("corner_crop",["ComplexNDArray"],w),n.variable(t("fourier_downsample")).define("fourier_downsample",["ComplexNDArray","nj","corner_crop"],j),n.variable(t("electron_wavelength_angstroms")).define("electron_wavelength_angstroms",y),n.variable(t("electron_interaction_parameter")).define("electron_interaction_parameter",["electron_wavelength_angstroms"],k),n.variable(t("ComplexProbe")).define("ComplexProbe",["electron_wavelength_angstroms","fftfreq","meshgrid2D","nj","atan2","ComplexNDArray","lt_int_s"],A),n.variable(t()).define(["md"],P),n}function I(e){return e`# Projection Set Algorithms

Here, we will illustrate another very powerful non-convex optimization strategy used in ptychograghy, called "projection set methods".`}function z(e){return e`## Alternating Projections

Suppose we want to find the solution at the intersection of two sets:
1. a set of all points lying on the red line, and
2. a set of all point lying on the blue line.

Seems simple right? The catch is that we're only allowed to operate on one set at a time. A simple idea could be to take alternating steps where we "project" on one of the sets.

_Note:_ By "project" here we mean finding the closest point between our current location that lies on the set.

Let's try it!`}function M(e){return e.range([50,1e3],{value:200,step:25,label:"Animation speed [ms]"})}function q(e){return e.checkbox(["iterate","reset"],{value:[]})}function D(e,t){return e.plot({x:{axis:!1,domain:[-.5,9/8]},y:{axis:!1,domain:[-1/4,.5]},aspectRatio:1,style:{background:"none"},marks:[e.line([{x:-.5,y:-1/4,set:1,col:"red"},{x:9/8,y:9/16,set:1,col:"red"},{x:-.5,y:-1/16,set:2,col:"blue"},{x:9/8,y:9/64,set:2,col:"blue"}],{x:"x",y:"y",z:"set",stroke:"col"}),e.line(t,{stroke:"orange"}),e.dot(t,{fill:"orange",fillOpacity:.5,r:10})]})}function C(e){return e`## Non-Convex Sets?

The above example was rather easy, since both our sets were convex. What do you think will happen for non-convex sets? E.g. two disconnected half-lines. Well, our naive alternating projection algorithm will get stuck!`}function S(e){return e.checkbox(["iterate","reset"],{value:[]})}function E(e,t){return e.plot({x:{axis:!1,domain:[-.5,9/8]},y:{axis:!1,domain:[-1/4,.5]},aspectRatio:1,style:{background:"none"},marks:[e.line([{x:-.5,y:-1/4,set:1,col:"red"},{x:1/4,y:1/8,set:1,col:"red"},{x:.5,y:1/4,set:2,col:"red"},{x:9/8,y:9/16,set:2,col:"red"},{x:-.5,y:-1/16,set:3,col:"blue"},{x:1/4,y:1/32,set:3,col:"blue"},{x:.5,y:1/16,set:4,col:"blue"},{x:9/8,y:9/64,set:4,col:"blue"}],{x:"x",y:"y",z:"set",stroke:"col"}),e.line(t,{stroke:"orange"}),e.dot(t,{fill:"orange",fillOpacity:.5,r:10})]})}function G(e){return e`## Generalized Projections

Turns out, we don't just have to "project" to the set exactly - we can also e.g. reflect about the set to allow for a wide search-space. More generally, we can define a "family" of generalized projection set algorithms according to the iteration:`}function N(e){return e.block`
x_{k+1} \leftarrow \left(1-a-b \right)x_k + a \Pi_1 \left[x_k\right] + b \Pi_2 \left[c \Pi[x_k]+\left(1-c\right)x_k \right]
`}function T(e,t){return t`For scalar parameters ${e`(a,b,c)`}.

Some named choices include:
- Alternating Projections (AP): ${e`(a=0,b=1,c=1)`}
- Difference Map (DM): ${e`(a=-1,b=1,c=2)`}
- Relax Reflect Reflect (RRR): ${e`(a=-\gamma,b=\gamma,c=2)`}
- Relaxed Averaged Alternating Reflections (RAAR): ${e`(a=1-2\gamma,b=\gamma,c=2)`}`}function B(e){return e.form({projection_name:e.radio(["AP","DM","RRR","RAAR","Generalized"],{value:"AP",label:"projection"}),projection_gamma:e.range([0,1],{value:.875,step:.001,label:"relaxation \u03b3"})})}function O(e,t,n){return e.form({projection_a:e.range([-1,1],{value:`${"Generalized"==t.projection_name?0:n[t.projection_name].a}`,step:.001,label:"parameter a"}),projection_b:e.range([0,2],{value:`${"Generalized"==t.projection_name?1:n[t.projection_name].b}`,step:.001,label:"parameter b"}),projection_c:e.range([0,2],{value:`${"Generalized"==t.projection_name?1:n[t.projection_name].c}`,step:.001,label:"parameter c"})})}function V(e,t){return t`## Multiple Sets

In general, our algorithm above relies on only two generalized projections. When we have more than two sets, we need to reformulate our constraints in the form above. 

A simple way to do this is to apply our projections on a copy of the current iterate separately (${e`\Pi_1`} above), and then average our points together (${e`\Pi_2`} above).`}function X(e){return e.checkbox(["iterate","reset"],{value:[]})}function J(e,t,n){let r=[...Array(e.shape[0])].map(((t,n)=>({x:e.get(n,0),y:e.get(n,1),set:5,col:"green"}))),i=t.map((e=>e.reduce(((e,t)=>[e[0]+t[0],e[1]+t[1]])).map((t=>t/e.length))));return n.plot({x:{axis:!1,domain:[-.5,9/8]},y:{axis:!1,domain:[-1/4,.5]},aspectRatio:1,style:{background:"none"},marks:[n.line([{x:-.5,y:-1/4,set:1,col:"red"},{x:1/4,y:1/8,set:1,col:"red"},{x:.5,y:1/4,set:2,col:"red"},{x:9/8,y:9/16,set:2,col:"red"},{x:-.5,y:-1/16,set:3,col:"blue"},{x:1/4,y:1/32,set:3,col:"blue"},{x:.5,y:1/16,set:4,col:"blue"},{x:9/8,y:9/64,set:4,col:"blue"},...r],{x:"x",y:"y",z:"set",stroke:"col"}),n.line(i,{stroke:"orange"}),n.dot(i,{fill:"orange",fillOpacity:.5,r:10})]})}function Q(e){return e.html`<hr class="hideable-md">`}function Y(e){return{AP:{a:0,b:1,c:1},DM:{a:-1,b:1,c:2},RRR:{a:-e.projection_gamma,b:e.projection_gamma,c:2},RAAR:{a:1-2*e.projection_gamma,b:e.projection_gamma,c:2}}}function L(e){let t=e.arange(0,2*Math.PI,Math.PI/512),n=[-5/4*Math.cos(Math.PI/8),-5/4*Math.sin(Math.PI/8)],r=e.sin(t.multiply(4)).divide(4).add(1),i=r.multiply(e.cos(t)).subtract(n[0]).divide(3),o=r.multiply(e.sin(t)).subtract(n[1]).divide(3);return e.stack([i,o],-1)}function U(){return function(e){let[t,n]=e;return[.4*(2*t+n),(2*t+n)/5]}}function F(){return function(e){let[t,n]=e;return[32/65*(2*t+n/4),4/65*(2*t+n/4)]}}function K(){return function(e){let[t,n]=e;if(8*t+4*n>=5||2*t+n<=5/8){let e=(2*t+n)/5;return[2*e,e]}if(15/16<2*t+n&&2*t+n<5/4)return[.5,1/4];if(2*t+n>5/8)return[1/4,1/8];{let e=2*n/5+4*t/5-1/8;return[2*e,e]}}}function W(){return function(e){let[t,n]=e;if(8*t+n>=65/16||8*t+n<=65/32){let e=(8*t+n)/65;return[8*e,e]}if(195/64<8*t+n&&t+n<65/16)return[.5,1/16];if(8*t+n>=65/32)return[1/4,1/32];{let e=2*n/65+16*t/64-1/32;return[8*e,e]}}}function H(e,t){return function(n){let[r,i]=n,o=e.add(t.pick(null,0).subtract(r).pow(2),t.pick(null,1).subtract(i).pow(2)).tolist().reduce(((e,t,n,r)=>t>r[e]?e:n),-1);return[t.get(o,0),t.get(o,1)]}}function Z(){return function(e,t,n){let[r,i,o]=n,a=1-r-i,l=1-o;return function(n){let[s,c]=n,[u,_]=e([s,c]),[f,d]=t([o*u+l*s,o*_+l*c]);return[a*s+r*u+i*f,a*c+r*_+i*d]}}}function $(){return function(e,t,n){return function(r){let[[i,o],[a,l],[s,c]]=r;return[e([i,o]),t([a,l]),n([s,c])]}}}function ee(){return function(e){let[[t,n],[r,i],[o,a]]=e,l=(t+r+o)/3,s=(n+i+a)/3;return[[l,s],[l,s],[l,s]]}}function te(e,t){return function(n,r,i,o){let[a,l,s]=o,c=1-a-l,u=1-s,_=e(n,r,i),f=t;return function(e){let[[t,n],[r,i],[o,d]]=e,[[p,v],[h,m],[b,g]]=_([[t,n],[r,i],[o,d]]),[[x,w],[j,y],[k,A]]=f([[s*p+u*t,s*v+u*n],[s*h+u*r,s*m+u*i],[s*b+u*o,s*g+u*d]]);return[[c*t+a*p+l*x,c*n+a*v+l*w],[c*r+a*h+l*j,c*i+a*m+l*y],[c*o+a*b+l*k,c*d+a*g+l*A]]}}}function ne(e,t,n,r){return e(t,n,[r.projection_a,r.projection_b,r.projection_c])}function re(e,t,n,r){return e(t,n,[r.projection_a,r.projection_b,r.projection_c])}function ie(e,t,n,r,i){return e(t,n,r,[i.projection_a,i.projection_b,i.projection_c])}function oe(){return[[1,.3]]}function ae(){return[[1,.3]]}function le(){return[[[1,.3],[1,.3],[1,.3]]]}function se(e,t){e.includes("reset")&&(t.value=[[1,.3]])}function*ce(e,t,n,r,i,o){let a=0;for(;e.includes("iterate");){yield t.tick(n,++a);let e=r.length;i.value=[...r,o(r[e-1])]}}function ue(e,t){e.includes("reset")&&(t.value=[[1,.3]])}function*_e(e,t,n,r,i,o){let a=0;for(;e.includes("iterate");){yield t.tick(n,++a);let e=r.length;i.value=[...r,o(r[e-1])]}}function fe(e,t){e.includes("reset")&&(t.value=[[[1,.3],[1,.3],[1,.3]]])}function*de(e,t,n,r,i,o){let a=0;for(;e.includes("iterate");){yield t.tick(n,++a);let e=r.length;i.value=[...r,o(r[e-1])]}}function pe(e,t){const n=e.module();n.variable(t()).define(["md"],I),n.variable(t()).define(["md"],z),n.variable(t("viewof animation_speed")).define("viewof animation_speed",["Inputs"],M),n.variable(t("animation_speed")).define("animation_speed",["Generators","viewof animation_speed"],((e,t)=>e.input(t))),n.variable(t("viewof iterate_convex")).define("viewof iterate_convex",["Inputs"],q),n.variable(t("iterate_convex")).define("iterate_convex",["Generators","viewof iterate_convex"],((e,t)=>e.input(t))),n.variable(t("two_convex_sets_plot")).define("two_convex_sets_plot",["Plot","iteration_pts_convex"],D),n.variable(t()).define(["md"],C),n.variable(t("viewof iterate_nonconvex")).define("viewof iterate_nonconvex",["Inputs"],S),n.variable(t("iterate_nonconvex")).define("iterate_nonconvex",["Generators","viewof iterate_nonconvex"],((e,t)=>e.input(t))),n.variable(t("two_nonconvex_sets_plot")).define("two_nonconvex_sets_plot",["Plot","iteration_pts_nonconvex"],E),n.variable(t()).define(["md"],G),n.variable(t()).define(["tex"],N),n.variable(t()).define(["tex","md"],T),n.variable(t("viewof projection_inputs_a")).define("viewof projection_inputs_a",["Inputs"],B),n.variable(t("projection_inputs_a")).define("projection_inputs_a",["Generators","viewof projection_inputs_a"],((e,t)=>e.input(t))),n.variable(t("viewof projection_inputs_b")).define("viewof projection_inputs_b",["Inputs","projection_inputs_a","named_projection_parameters"],O),n.variable(t("projection_inputs_b")).define("projection_inputs_b",["Generators","viewof projection_inputs_b"],((e,t)=>e.input(t))),n.variable(t()).define(["tex","md"],V),n.variable(t("viewof iterate_flower")).define("viewof iterate_flower",["Inputs"],X),n.variable(t("iterate_flower")).define("iterate_flower",["Generators","viewof iterate_flower"],((e,t)=>e.input(t))),n.variable(t("flower_sets_plot")).define("flower_sets_plot",["flower_values","iteration_pts_flower","Plot"],J),n.variable(t()).define(["htl"],Q);const r=e.module(R);return n.import("nj",r),n.variable(t("named_projection_parameters")).define("named_projection_parameters",["projection_inputs_a"],Y),n.variable(t("flower_values")).define("flower_values",["nj"],L),n.variable(t("region_nearest_convex_red")).define("region_nearest_convex_red",U),n.variable(t("region_nearest_convex_blue")).define("region_nearest_convex_blue",F),n.variable(t("region_nearest_nonconvex_red")).define("region_nearest_nonconvex_red",K),n.variable(t("region_nearest_nonconvex_blue")).define("region_nearest_nonconvex_blue",W),n.variable(t("region_nearest_flower_green")).define("region_nearest_flower_green",["nj","flower_values"],H),n.variable(t("generalized_projection")).define("generalized_projection",Z),n.variable(t("product_space_projection")).define("product_space_projection",$),n.variable(t("diagonal_projection")).define("diagonal_projection",ee),n.variable(t("generalized_projection_multiple")).define("generalized_projection_multiple",["product_space_projection","diagonal_projection"],te),n.variable(t("two_convex_sets")).define("two_convex_sets",["generalized_projection","region_nearest_convex_red","region_nearest_convex_blue","projection_inputs_b"],ne),n.variable(t("two_nonconvex_sets")).define("two_nonconvex_sets",["generalized_projection","region_nearest_nonconvex_red","region_nearest_nonconvex_blue","projection_inputs_b"],re),n.variable(t("three_nonconvex_sets")).define("three_nonconvex_sets",["generalized_projection_multiple","region_nearest_nonconvex_red","region_nearest_nonconvex_blue","region_nearest_flower_green","projection_inputs_b"],ie),n.define("initial iteration_pts_convex",oe),n.variable(t("mutable iteration_pts_convex")).define("mutable iteration_pts_convex",["Mutable","initial iteration_pts_convex"],((e,t)=>new e(t))),n.variable(t("iteration_pts_convex")).define("iteration_pts_convex",["mutable iteration_pts_convex"],(e=>e.generator)),n.define("initial iteration_pts_nonconvex",ae),n.variable(t("mutable iteration_pts_nonconvex")).define("mutable iteration_pts_nonconvex",["Mutable","initial iteration_pts_nonconvex"],((e,t)=>new e(t))),n.variable(t("iteration_pts_nonconvex")).define("iteration_pts_nonconvex",["mutable iteration_pts_nonconvex"],(e=>e.generator)),n.define("initial iteration_pts_flower",le),n.variable(t("mutable iteration_pts_flower")).define("mutable iteration_pts_flower",["Mutable","initial iteration_pts_flower"],((e,t)=>new e(t))),n.variable(t("iteration_pts_flower")).define("iteration_pts_flower",["mutable iteration_pts_flower"],(e=>e.generator)),n.variable(t("two_convex_sets_reset")).define("two_convex_sets_reset",["iterate_convex","mutable iteration_pts_convex"],se),n.variable(t("two_convex_sets_generator")).define("two_convex_sets_generator",["iterate_convex","Promises","animation_speed","iteration_pts_convex","mutable iteration_pts_convex","two_convex_sets"],ce),n.variable(t("two_nonconvex_sets_reset")).define("two_nonconvex_sets_reset",["iterate_nonconvex","mutable iteration_pts_nonconvex"],ue),n.variable(t("two_nonconvex_sets_generator")).define("two_nonconvex_sets_generator",["iterate_nonconvex","Promises","animation_speed","iteration_pts_nonconvex","mutable iteration_pts_nonconvex","two_nonconvex_sets"],_e),n.variable(t("flower_sets_reset")).define("flower_sets_reset",["iterate_flower","mutable iteration_pts_flower"],fe),n.variable(t("flower_sets_generator")).define("flower_sets_generator",["iterate_flower","Promises","animation_speed","iteration_pts_flower","mutable iteration_pts_flower","three_nonconvex_sets"],de),n}function ve(e){return e}function he(e){return e}function me(e){return e.html`<hr class="hideable-md">`}function be(e){return e}function ge(e){return e}function xe(e,t){const n=e.module();n.variable(t()).define(["viewof iterate_convex"],ve),n.variable(t()).define(["two_convex_sets_plot"],he),n.variable(t()).define(["htl"],me);const r=e.module(pe);return n.import("viewof iterate_convex",r),n.import("iterate_convex",r),n.import("two_convex_sets_plot",r),n.import("two_convex_sets_generator",r),n.import("two_convex_sets_reset",r),n.variable(t()).define(["two_convex_sets_generator"],be),n.variable(t()).define(["two_convex_sets_reset"],ge),n}const we=function(){const e=(0,l.useRef)();return(0,l.useEffect)((()=>{const t=new s.Runtime;return t.module(xe,s.Inspector.into(e.current)),()=>t.dispose()}),[]),(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{ref:e})})};function je(e){return e`# Ptychography Helper Functions`}function ye(e){return e.html`<hr class="hideable-md">`}function ke(e){return e("https://cdn.jsdelivr.net/gh/nicolaspanel/numjs@0.16/dist/numjs.min.js")}function Ae(e){return e("https://bundle.run/ndarray-ops@1.2.2")}function Pe(e){return e("https://bundle.run/ndarray-complex@1.0.3")}function Re(e,t){return function(n,r){let i=e.zeros(n.shape);return t.atan2(i.selection,n.selection,r.selection),i}}function Ie(e,t){return function(n,r){let i=e.zeros(n.shape);return t.lts(i.selection,n.selection,r),t.bandseq(i.selection,1),i}}function ze(e,t,n){return class r{constructor(t){this.shape=t;let n=t.slice();n.push(2),this.data=e.zeros(n),this._nulls=new Array(t.length).fill(null)}re(){return this.data.pick(...this._nulls,0)}im(){return this.data.pick(...this._nulls,1)}abs(){return e.sqrt(this.abs_sqr())}abs_sqr(){return e.add(this.re().multiply(this.re()),this.im().multiply(this.im()))}angle(){return t(this.im(),this.re())}clone(){let e=new r(this.shape);return e.data=this.data.clone(),e}conjugate(){let t=this.re().clone(),i=this.im().clone();n.conjeq(t.selection,i.selection);let o=new r(this.shape);return o.data=e.stack([t,i],-1),o}multiply(t){let i=this.re().clone(),o=this.im().clone(),a=t.re(),l=t.im();n.muleq(i.selection,o.selection,a.selection,l.selection);let s=new r(this.shape);return s.data=e.stack([i,o],-1),s}real_multiply(t){let i=this.re().clone(),o=this.im().clone(),a=t,l=e.zeros(t.shape);n.muleq(i.selection,o.selection,a.selection,l.selection);let s=new r(this.shape);return s.data=e.stack([i,o],-1),s}scalar_multiply(t,i){let o=this.re().clone(),a=this.im().clone();n.mulseq(o.selection,a.selection,t,i);let l=new r(this.shape);return l.data=e.stack([o,a],-1),l}add(t){let i=this.re().clone(),o=this.im().clone(),a=t.re(),l=t.im();n.addeq(i.selection,o.selection,a.selection,l.selection);let s=new r(this.shape);return s.data=e.stack([i,o],-1),s}subtract(t){let i=this.re().clone(),o=this.im().clone(),a=t.re(),l=t.im();n.subeq(i.selection,o.selection,a.selection,l.selection);let s=new r(this.shape);return s.data=e.stack([i,o],-1),s}}}function Me(e){return function(t,n){let r=e.zeros(t),i=1/(t*n),o=1+((t-1)/2|0);for(var a=0;a<o;a++)r.set(a,a*i);for(a=o;a<t;a++)r.set(a,(a-t)*i);return r}}function qe(e){return function(t,n){let r=[t.size,n.size],i=[];i[0]=e.zeros(r),i[1]=e.zeros(r);for(let e=0;e<r[1];e++)for(let o=0;o<r[0];o++)i[0].set(o,e,t.get(o)),i[1].set(o,e,n.get(e));return i}}function De(e){return function(t){let[n,r]=t.shape,i=n/2|0,o=r/2|0,a=e.zeros([n,r]);return a.slice([null,i],[null,o]).assign(t.slice(-i,-o),!1),a.slice([null,i],o).assign(t.slice(-i,[null,o]),!1),a.slice(-i,-o).assign(t.slice([null,i],[null,o]),!1),a.slice(-i,[null,o]).assign(t.slice([null,i],-o),!1),a}}function Ce(e,t,n,r){return function(i,o){let[a,l]=i.shape,[s,c]=o,u=new e([a,l]);u.data=t.fft(i.data);let _=n(a,1),f=n(l,1),[d,p]=r(_,f),v=-2*Math.PI,h=t.add(d.multiply(s),p.multiply(c)).multiply(v),m=new e([a,l]),b=t.cos(h),g=t.sin(h);m.data=t.stack([b,g],-1);let x=u.multiply(m);return x.data=t.ifft(x.data),x}}function Se(e){return function(t,n){let[r,i]=n,o=new e([r,i]),a=r/2|0,l=i/2|0;return o.data.slice([null,a],[null,l],null).assign(t.slice([null,a],[null,l],null),!1),o.data.slice(-a,[null,l],null).assign(t.slice(-a,[null,l],null),!1),o.data.slice([null,a],-l,null).assign(t.slice([null,a],-l,null),!1),o.data.slice(-a,-l,null).assign(t.slice(-a,-l,null),!1),o}}function Ee(e,t,n){return function(r,i){let[o,a]=r.shape;console.log(o);let l=new e([o,a]);l.data=t.fft(r.data);let[s,c]=[o/i|0,a/i|0],u=n(l.data,[s,c]);return u.data=t.ifft(u.data),u}}function Ge(){return function(e){let t=9.109383*1e-30,n=1602177e-24,r=299792458;return 662607e-39/Math.sqrt(2*t*n*e)/Math.sqrt(1+n*e/2/t/r/r)*1e11}}function Ne(e){return function(t){let n=9.109383*1e-30,r=1602177e-24,i=299792458,o=e(t);return 2*Math.PI/o/t*(n*i*i+r*t)/(2*n*i*i+r*t)}}function Te(e,t,n,r,i,o,a){return class{constructor(t,n,r,i,o){this._gpts=t.slice(),this._sampling=n.slice(),this._energy=r,this._wavelength=e(r),this._semiangle_cutoff=i,this._defocus=o}_get_scattering_angles(){let e=t(this._gpts[0],this._sampling[0]),o=t(this._gpts[1],this._sampling[1]),[a,l]=n(e,o);return[r.sqrt(r.add(a.multiply(a.multiply(this._wavelength*this._wavelength)),l.multiply(l.multiply(this._wavelength*this._wavelength)))),i(a,l)]}_evaluate_aberrations(e,t){let n=this._defocus/this._wavelength*Math.PI,i=e.multiply(e).multiply(n),a=r.cos(i),l=r.sin(i),s=new o(i.shape);return s.data=r.stack([a,l],-1),s}_evaluate_aperture(e,t){let n=this._semiangle_cutoff/1e3,i=new o(e.shape),l=a(e,n);return i.data=r.stack([l,r.zeros(e.shape)],-1),i}build(){let[e,t]=this._get_scattering_angles(),n=this._evaluate_aberrations(e,t),i=this._evaluate_aperture(e,t),a=n.multiply(i);this._fourier_array=a;let l=new o(a.shape);l.data=r.ifft(a.data);let s=Math.sqrt(l.abs_sqr().sum());return this._array=l.scalar_multiply(1/s,0),this}}}function Be(e){return e`https://observablehq.com/@mootari/notebook-data`}function Oe(e,t){const n=e.module();return n.variable(t()).define(["md"],je),n.variable(t()).define(["htl"],ye),n.variable(t("nj")).define("nj",["require"],ke),n.variable(t("ops")).define("ops",["require"],Ae),n.variable(t("cops")).define("cops",["require"],Pe),n.variable(t("atan2")).define("atan2",["nj","ops"],Re),n.variable(t("lt_int_s")).define("lt_int_s",["nj","ops"],Ie),n.variable(t("ComplexNDArray")).define("ComplexNDArray",["nj","atan2","cops"],ze),n.variable(t("fftfreq")).define("fftfreq",["nj"],Me),n.variable(t("meshgrid2D")).define("meshgrid2D",["nj"],qe),n.variable(t("fftshift2D")).define("fftshift2D",["nj"],De),n.variable(t("fourier_shift")).define("fourier_shift",["ComplexNDArray","nj","fftfreq","meshgrid2D"],Ce),n.variable(t("corner_crop")).define("corner_crop",["ComplexNDArray"],Se),n.variable(t("fourier_downsample")).define("fourier_downsample",["ComplexNDArray","nj","corner_crop"],Ee),n.variable(t("electron_wavelength_angstroms")).define("electron_wavelength_angstroms",Ge),n.variable(t("electron_interaction_parameter")).define("electron_interaction_parameter",["electron_wavelength_angstroms"],Ne),n.variable(t("ComplexProbe")).define("ComplexProbe",["electron_wavelength_angstroms","fftfreq","meshgrid2D","nj","atan2","ComplexNDArray","lt_int_s"],Te),n.variable(t()).define(["md"],Be),n}function Ve(e){return e`# Projection Set Algorithms

Here, we will illustrate another very powerful non-convex optimization strategy used in ptychograghy, called "projection set methods".`}function Xe(e){return e`## Alternating Projections

Suppose we want to find the solution at the intersection of two sets:
1. a set of all points lying on the red line, and
2. a set of all point lying on the blue line.

Seems simple right? The catch is that we're only allowed to operate on one set at a time. A simple idea could be to take alternating steps where we "project" on one of the sets.

_Note:_ By "project" here we mean finding the closest point between our current location that lies on the set.

Let's try it!`}function Je(e){return e.range([50,1e3],{value:200,step:25,label:"Animation speed [ms]"})}function Qe(e){return e.checkbox(["iterate","reset"],{value:[]})}function Ye(e,t){return e.plot({x:{axis:!1,domain:[-.5,9/8]},y:{axis:!1,domain:[-1/4,.5]},aspectRatio:1,style:{background:"none"},marks:[e.line([{x:-.5,y:-1/4,set:1,col:"red"},{x:9/8,y:9/16,set:1,col:"red"},{x:-.5,y:-1/16,set:2,col:"blue"},{x:9/8,y:9/64,set:2,col:"blue"}],{x:"x",y:"y",z:"set",stroke:"col"}),e.line(t,{stroke:"orange"}),e.dot(t,{fill:"orange",fillOpacity:.5,r:10})]})}function Le(e){return e`## Non-Convex Sets?

The above example was rather easy, since both our sets were convex. What do you think will happen for non-convex sets? E.g. two disconnected half-lines. Well, our naive alternating projection algorithm will get stuck!`}function Ue(e){return e.checkbox(["iterate","reset"],{value:[]})}function Fe(e,t){return e.plot({x:{axis:!1,domain:[-.5,9/8]},y:{axis:!1,domain:[-1/4,.5]},aspectRatio:1,style:{background:"none"},marks:[e.line([{x:-.5,y:-1/4,set:1,col:"red"},{x:1/4,y:1/8,set:1,col:"red"},{x:.5,y:1/4,set:2,col:"red"},{x:9/8,y:9/16,set:2,col:"red"},{x:-.5,y:-1/16,set:3,col:"blue"},{x:1/4,y:1/32,set:3,col:"blue"},{x:.5,y:1/16,set:4,col:"blue"},{x:9/8,y:9/64,set:4,col:"blue"}],{x:"x",y:"y",z:"set",stroke:"col"}),e.line(t,{stroke:"orange"}),e.dot(t,{fill:"orange",fillOpacity:.5,r:10})]})}function Ke(e){return e`## Generalized Projections

Turns out, we don't just have to "project" to the set exactly - we can also e.g. reflect about the set to allow for a wide search-space. More generally, we can define a "family" of generalized projection set algorithms according to the iteration:`}function We(e){return e.block`
x_{k+1} \leftarrow \left(1-a-b \right)x_k + a \Pi_1 \left[x_k\right] + b \Pi_2 \left[c \Pi[x_k]+\left(1-c\right)x_k \right]
`}function He(e,t){return t`For scalar parameters ${e`(a,b,c)`}.

Some named choices include:
- Alternating Projections (AP): ${e`(a=0,b=1,c=1)`}
- Difference Map (DM): ${e`(a=-1,b=1,c=2)`}
- Relax Reflect Reflect (RRR): ${e`(a=-\gamma,b=\gamma,c=2)`}
- Relaxed Averaged Alternating Reflections (RAAR): ${e`(a=1-2\gamma,b=\gamma,c=2)`}`}function Ze(e){return e.form({projection_name:e.radio(["AP","DM","RRR","RAAR","Generalized"],{value:"AP",label:"projection"}),projection_gamma:e.range([0,1],{value:.875,step:.001,label:"relaxation \u03b3"})})}function $e(e,t,n){return e.form({projection_a:e.range([-1,1],{value:`${"Generalized"==t.projection_name?0:n[t.projection_name].a}`,step:.001,label:"parameter a"}),projection_b:e.range([0,2],{value:`${"Generalized"==t.projection_name?1:n[t.projection_name].b}`,step:.001,label:"parameter b"}),projection_c:e.range([0,2],{value:`${"Generalized"==t.projection_name?1:n[t.projection_name].c}`,step:.001,label:"parameter c"})})}function et(e,t){return t`## Multiple Sets

In general, our algorithm above relies on only two generalized projections. When we have more than two sets, we need to reformulate our constraints in the form above. 

A simple way to do this is to apply our projections on a copy of the current iterate separately (${e`\Pi_1`} above), and then average our points together (${e`\Pi_2`} above).`}function tt(e){return e.checkbox(["iterate","reset"],{value:[]})}function nt(e,t,n){let r=[...Array(e.shape[0])].map(((t,n)=>({x:e.get(n,0),y:e.get(n,1),set:5,col:"green"}))),i=t.map((e=>e.reduce(((e,t)=>[e[0]+t[0],e[1]+t[1]])).map((t=>t/e.length))));return n.plot({x:{axis:!1,domain:[-.5,9/8]},y:{axis:!1,domain:[-1/4,.5]},aspectRatio:1,style:{background:"none"},marks:[n.line([{x:-.5,y:-1/4,set:1,col:"red"},{x:1/4,y:1/8,set:1,col:"red"},{x:.5,y:1/4,set:2,col:"red"},{x:9/8,y:9/16,set:2,col:"red"},{x:-.5,y:-1/16,set:3,col:"blue"},{x:1/4,y:1/32,set:3,col:"blue"},{x:.5,y:1/16,set:4,col:"blue"},{x:9/8,y:9/64,set:4,col:"blue"},...r],{x:"x",y:"y",z:"set",stroke:"col"}),n.line(i,{stroke:"orange"}),n.dot(i,{fill:"orange",fillOpacity:.5,r:10})]})}function rt(e){return e.html`<hr class="hideable-md">`}function it(e){return{AP:{a:0,b:1,c:1},DM:{a:-1,b:1,c:2},RRR:{a:-e.projection_gamma,b:e.projection_gamma,c:2},RAAR:{a:1-2*e.projection_gamma,b:e.projection_gamma,c:2}}}function ot(e){let t=e.arange(0,2*Math.PI,Math.PI/512),n=[-5/4*Math.cos(Math.PI/8),-5/4*Math.sin(Math.PI/8)],r=e.sin(t.multiply(4)).divide(4).add(1),i=r.multiply(e.cos(t)).subtract(n[0]).divide(3),o=r.multiply(e.sin(t)).subtract(n[1]).divide(3);return e.stack([i,o],-1)}function at(){return function(e){let[t,n]=e;return[.4*(2*t+n),(2*t+n)/5]}}function lt(){return function(e){let[t,n]=e;return[32/65*(2*t+n/4),4/65*(2*t+n/4)]}}function st(){return function(e){let[t,n]=e;if(8*t+4*n>=5||2*t+n<=5/8){let e=(2*t+n)/5;return[2*e,e]}if(15/16<2*t+n&&2*t+n<5/4)return[.5,1/4];if(2*t+n>5/8)return[1/4,1/8];{let e=2*n/5+4*t/5-1/8;return[2*e,e]}}}function ct(){return function(e){let[t,n]=e;if(8*t+n>=65/16||8*t+n<=65/32){let e=(8*t+n)/65;return[8*e,e]}if(195/64<8*t+n&&t+n<65/16)return[.5,1/16];if(8*t+n>=65/32)return[1/4,1/32];{let e=2*n/65+16*t/64-1/32;return[8*e,e]}}}function ut(e,t){return function(n){let[r,i]=n,o=e.add(t.pick(null,0).subtract(r).pow(2),t.pick(null,1).subtract(i).pow(2)).tolist().reduce(((e,t,n,r)=>t>r[e]?e:n),-1);return[t.get(o,0),t.get(o,1)]}}function _t(){return function(e,t,n){let[r,i,o]=n,a=1-r-i,l=1-o;return function(n){let[s,c]=n,[u,_]=e([s,c]),[f,d]=t([o*u+l*s,o*_+l*c]);return[a*s+r*u+i*f,a*c+r*_+i*d]}}}function ft(){return function(e,t,n){return function(r){let[[i,o],[a,l],[s,c]]=r;return[e([i,o]),t([a,l]),n([s,c])]}}}function dt(){return function(e){let[[t,n],[r,i],[o,a]]=e,l=(t+r+o)/3,s=(n+i+a)/3;return[[l,s],[l,s],[l,s]]}}function pt(e,t){return function(n,r,i,o){let[a,l,s]=o,c=1-a-l,u=1-s,_=e(n,r,i),f=t;return function(e){let[[t,n],[r,i],[o,d]]=e,[[p,v],[h,m],[b,g]]=_([[t,n],[r,i],[o,d]]),[[x,w],[j,y],[k,A]]=f([[s*p+u*t,s*v+u*n],[s*h+u*r,s*m+u*i],[s*b+u*o,s*g+u*d]]);return[[c*t+a*p+l*x,c*n+a*v+l*w],[c*r+a*h+l*j,c*i+a*m+l*y],[c*o+a*b+l*k,c*d+a*g+l*A]]}}}function vt(e,t,n,r){return e(t,n,[r.projection_a,r.projection_b,r.projection_c])}function ht(e,t,n,r){return e(t,n,[r.projection_a,r.projection_b,r.projection_c])}function mt(e,t,n,r,i){return e(t,n,r,[i.projection_a,i.projection_b,i.projection_c])}function bt(){return[[1,.3]]}function gt(){return[[1,.3]]}function xt(){return[[[1,.3],[1,.3],[1,.3]]]}function wt(e,t){e.includes("reset")&&(t.value=[[1,.3]])}function*jt(e,t,n,r,i,o){let a=0;for(;e.includes("iterate");){yield t.tick(n,++a);let e=r.length;i.value=[...r,o(r[e-1])]}}function yt(e,t){e.includes("reset")&&(t.value=[[1,.3]])}function*kt(e,t,n,r,i,o){let a=0;for(;e.includes("iterate");){yield t.tick(n,++a);let e=r.length;i.value=[...r,o(r[e-1])]}}function At(e,t){e.includes("reset")&&(t.value=[[[1,.3],[1,.3],[1,.3]]])}function*Pt(e,t,n,r,i,o){let a=0;for(;e.includes("iterate");){yield t.tick(n,++a);let e=r.length;i.value=[...r,o(r[e-1])]}}function Rt(e,t){const n=e.module();n.variable(t()).define(["md"],Ve),n.variable(t()).define(["md"],Xe),n.variable(t("viewof animation_speed")).define("viewof animation_speed",["Inputs"],Je),n.variable(t("animation_speed")).define("animation_speed",["Generators","viewof animation_speed"],((e,t)=>e.input(t))),n.variable(t("viewof iterate_convex")).define("viewof iterate_convex",["Inputs"],Qe),n.variable(t("iterate_convex")).define("iterate_convex",["Generators","viewof iterate_convex"],((e,t)=>e.input(t))),n.variable(t("two_convex_sets_plot")).define("two_convex_sets_plot",["Plot","iteration_pts_convex"],Ye),n.variable(t()).define(["md"],Le),n.variable(t("viewof iterate_nonconvex")).define("viewof iterate_nonconvex",["Inputs"],Ue),n.variable(t("iterate_nonconvex")).define("iterate_nonconvex",["Generators","viewof iterate_nonconvex"],((e,t)=>e.input(t))),n.variable(t("two_nonconvex_sets_plot")).define("two_nonconvex_sets_plot",["Plot","iteration_pts_nonconvex"],Fe),n.variable(t()).define(["md"],Ke),n.variable(t()).define(["tex"],We),n.variable(t()).define(["tex","md"],He),n.variable(t("viewof projection_inputs_a")).define("viewof projection_inputs_a",["Inputs"],Ze),n.variable(t("projection_inputs_a")).define("projection_inputs_a",["Generators","viewof projection_inputs_a"],((e,t)=>e.input(t))),n.variable(t("viewof projection_inputs_b")).define("viewof projection_inputs_b",["Inputs","projection_inputs_a","named_projection_parameters"],$e),n.variable(t("projection_inputs_b")).define("projection_inputs_b",["Generators","viewof projection_inputs_b"],((e,t)=>e.input(t))),n.variable(t()).define(["tex","md"],et),n.variable(t("viewof iterate_flower")).define("viewof iterate_flower",["Inputs"],tt),n.variable(t("iterate_flower")).define("iterate_flower",["Generators","viewof iterate_flower"],((e,t)=>e.input(t))),n.variable(t("flower_sets_plot")).define("flower_sets_plot",["flower_values","iteration_pts_flower","Plot"],nt),n.variable(t()).define(["htl"],rt);const r=e.module(Oe);return n.import("nj",r),n.variable(t("named_projection_parameters")).define("named_projection_parameters",["projection_inputs_a"],it),n.variable(t("flower_values")).define("flower_values",["nj"],ot),n.variable(t("region_nearest_convex_red")).define("region_nearest_convex_red",at),n.variable(t("region_nearest_convex_blue")).define("region_nearest_convex_blue",lt),n.variable(t("region_nearest_nonconvex_red")).define("region_nearest_nonconvex_red",st),n.variable(t("region_nearest_nonconvex_blue")).define("region_nearest_nonconvex_blue",ct),n.variable(t("region_nearest_flower_green")).define("region_nearest_flower_green",["nj","flower_values"],ut),n.variable(t("generalized_projection")).define("generalized_projection",_t),n.variable(t("product_space_projection")).define("product_space_projection",ft),n.variable(t("diagonal_projection")).define("diagonal_projection",dt),n.variable(t("generalized_projection_multiple")).define("generalized_projection_multiple",["product_space_projection","diagonal_projection"],pt),n.variable(t("two_convex_sets")).define("two_convex_sets",["generalized_projection","region_nearest_convex_red","region_nearest_convex_blue","projection_inputs_b"],vt),n.variable(t("two_nonconvex_sets")).define("two_nonconvex_sets",["generalized_projection","region_nearest_nonconvex_red","region_nearest_nonconvex_blue","projection_inputs_b"],ht),n.variable(t("three_nonconvex_sets")).define("three_nonconvex_sets",["generalized_projection_multiple","region_nearest_nonconvex_red","region_nearest_nonconvex_blue","region_nearest_flower_green","projection_inputs_b"],mt),n.define("initial iteration_pts_convex",bt),n.variable(t("mutable iteration_pts_convex")).define("mutable iteration_pts_convex",["Mutable","initial iteration_pts_convex"],((e,t)=>new e(t))),n.variable(t("iteration_pts_convex")).define("iteration_pts_convex",["mutable iteration_pts_convex"],(e=>e.generator)),n.define("initial iteration_pts_nonconvex",gt),n.variable(t("mutable iteration_pts_nonconvex")).define("mutable iteration_pts_nonconvex",["Mutable","initial iteration_pts_nonconvex"],((e,t)=>new e(t))),n.variable(t("iteration_pts_nonconvex")).define("iteration_pts_nonconvex",["mutable iteration_pts_nonconvex"],(e=>e.generator)),n.define("initial iteration_pts_flower",xt),n.variable(t("mutable iteration_pts_flower")).define("mutable iteration_pts_flower",["Mutable","initial iteration_pts_flower"],((e,t)=>new e(t))),n.variable(t("iteration_pts_flower")).define("iteration_pts_flower",["mutable iteration_pts_flower"],(e=>e.generator)),n.variable(t("two_convex_sets_reset")).define("two_convex_sets_reset",["iterate_convex","mutable iteration_pts_convex"],wt),n.variable(t("two_convex_sets_generator")).define("two_convex_sets_generator",["iterate_convex","Promises","animation_speed","iteration_pts_convex","mutable iteration_pts_convex","two_convex_sets"],jt),n.variable(t("two_nonconvex_sets_reset")).define("two_nonconvex_sets_reset",["iterate_nonconvex","mutable iteration_pts_nonconvex"],yt),n.variable(t("two_nonconvex_sets_generator")).define("two_nonconvex_sets_generator",["iterate_nonconvex","Promises","animation_speed","iteration_pts_nonconvex","mutable iteration_pts_nonconvex","two_nonconvex_sets"],kt),n.variable(t("flower_sets_reset")).define("flower_sets_reset",["iterate_flower","mutable iteration_pts_flower"],At),n.variable(t("flower_sets_generator")).define("flower_sets_generator",["iterate_flower","Promises","animation_speed","iteration_pts_flower","mutable iteration_pts_flower","three_nonconvex_sets"],Pt),n}function It(e){return e}function zt(e){return e}function Mt(e){return e}function qt(e){return e}function Dt(e){return e.html`<hr class="hideable-md" >`}function Ct(e){return e}function St(e){return e}function Et(e,t){const n=e.module();n.variable(t()).define(["viewof iterate_nonconvex"],It),n.variable(t()).define(["two_nonconvex_sets_plot"],zt),n.variable(t()).define(["viewof projection_inputs_a"],Mt),n.variable(t()).define(["viewof projection_inputs_b"],qt),n.variable(t()).define(["htl"],Dt);const r=e.module(Rt);return n.import("viewof iterate_nonconvex",r),n.import("iterate_nonconvex",r),n.import("two_nonconvex_sets_plot",r),n.import("two_nonconvex_sets_generator",r),n.import("two_nonconvex_sets_reset",r),n.import("viewof projection_inputs_a",r),n.import("projection_inputs_a",r),n.import("viewof projection_inputs_b",r),n.import("projection_inputs_b",r),n.variable(t()).define(["two_nonconvex_sets_generator"],Ct),n.variable(t()).define(["two_nonconvex_sets_reset"],St),n}const Gt=function(){const e=(0,l.useRef)();return(0,l.useEffect)((()=>{const t=new s.Runtime;return t.module(Et,s.Inspector.into(e.current)),()=>t.dispose()}),[]),(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{ref:e})})};function Nt(e){return e`# Ptychography Helper Functions`}function Tt(e){return e.html`<hr class="hideable-md">`}function Bt(e){return e("https://cdn.jsdelivr.net/gh/nicolaspanel/numjs@0.16/dist/numjs.min.js")}function Ot(e){return e("https://bundle.run/ndarray-ops@1.2.2")}function Vt(e){return e("https://bundle.run/ndarray-complex@1.0.3")}function Xt(e,t){return function(n,r){let i=e.zeros(n.shape);return t.atan2(i.selection,n.selection,r.selection),i}}function Jt(e,t){return function(n,r){let i=e.zeros(n.shape);return t.lts(i.selection,n.selection,r),t.bandseq(i.selection,1),i}}function Qt(e,t,n){return class r{constructor(t){this.shape=t;let n=t.slice();n.push(2),this.data=e.zeros(n),this._nulls=new Array(t.length).fill(null)}re(){return this.data.pick(...this._nulls,0)}im(){return this.data.pick(...this._nulls,1)}abs(){return e.sqrt(this.abs_sqr())}abs_sqr(){return e.add(this.re().multiply(this.re()),this.im().multiply(this.im()))}angle(){return t(this.im(),this.re())}clone(){let e=new r(this.shape);return e.data=this.data.clone(),e}conjugate(){let t=this.re().clone(),i=this.im().clone();n.conjeq(t.selection,i.selection);let o=new r(this.shape);return o.data=e.stack([t,i],-1),o}multiply(t){let i=this.re().clone(),o=this.im().clone(),a=t.re(),l=t.im();n.muleq(i.selection,o.selection,a.selection,l.selection);let s=new r(this.shape);return s.data=e.stack([i,o],-1),s}real_multiply(t){let i=this.re().clone(),o=this.im().clone(),a=t,l=e.zeros(t.shape);n.muleq(i.selection,o.selection,a.selection,l.selection);let s=new r(this.shape);return s.data=e.stack([i,o],-1),s}scalar_multiply(t,i){let o=this.re().clone(),a=this.im().clone();n.mulseq(o.selection,a.selection,t,i);let l=new r(this.shape);return l.data=e.stack([o,a],-1),l}add(t){let i=this.re().clone(),o=this.im().clone(),a=t.re(),l=t.im();n.addeq(i.selection,o.selection,a.selection,l.selection);let s=new r(this.shape);return s.data=e.stack([i,o],-1),s}subtract(t){let i=this.re().clone(),o=this.im().clone(),a=t.re(),l=t.im();n.subeq(i.selection,o.selection,a.selection,l.selection);let s=new r(this.shape);return s.data=e.stack([i,o],-1),s}}}function Yt(e){return function(t,n){let r=e.zeros(t),i=1/(t*n),o=1+((t-1)/2|0);for(var a=0;a<o;a++)r.set(a,a*i);for(a=o;a<t;a++)r.set(a,(a-t)*i);return r}}function Lt(e){return function(t,n){let r=[t.size,n.size],i=[];i[0]=e.zeros(r),i[1]=e.zeros(r);for(let e=0;e<r[1];e++)for(let o=0;o<r[0];o++)i[0].set(o,e,t.get(o)),i[1].set(o,e,n.get(e));return i}}function Ut(e){return function(t){let[n,r]=t.shape,i=n/2|0,o=r/2|0,a=e.zeros([n,r]);return a.slice([null,i],[null,o]).assign(t.slice(-i,-o),!1),a.slice([null,i],o).assign(t.slice(-i,[null,o]),!1),a.slice(-i,-o).assign(t.slice([null,i],[null,o]),!1),a.slice(-i,[null,o]).assign(t.slice([null,i],-o),!1),a}}function Ft(e,t,n,r){return function(i,o){let[a,l]=i.shape,[s,c]=o,u=new e([a,l]);u.data=t.fft(i.data);let _=n(a,1),f=n(l,1),[d,p]=r(_,f),v=-2*Math.PI,h=t.add(d.multiply(s),p.multiply(c)).multiply(v),m=new e([a,l]),b=t.cos(h),g=t.sin(h);m.data=t.stack([b,g],-1);let x=u.multiply(m);return x.data=t.ifft(x.data),x}}function Kt(e){return function(t,n){let[r,i]=n,o=new e([r,i]),a=r/2|0,l=i/2|0;return o.data.slice([null,a],[null,l],null).assign(t.slice([null,a],[null,l],null),!1),o.data.slice(-a,[null,l],null).assign(t.slice(-a,[null,l],null),!1),o.data.slice([null,a],-l,null).assign(t.slice([null,a],-l,null),!1),o.data.slice(-a,-l,null).assign(t.slice(-a,-l,null),!1),o}}function Wt(e,t,n){return function(r,i){let[o,a]=r.shape;console.log(o);let l=new e([o,a]);l.data=t.fft(r.data);let[s,c]=[o/i|0,a/i|0],u=n(l.data,[s,c]);return u.data=t.ifft(u.data),u}}function Ht(){return function(e){let t=9.109383*1e-30,n=1602177e-24,r=299792458;return 662607e-39/Math.sqrt(2*t*n*e)/Math.sqrt(1+n*e/2/t/r/r)*1e11}}function Zt(e){return function(t){let n=9.109383*1e-30,r=1602177e-24,i=299792458,o=e(t);return 2*Math.PI/o/t*(n*i*i+r*t)/(2*n*i*i+r*t)}}function $t(e,t,n,r,i,o,a){return class{constructor(t,n,r,i,o){this._gpts=t.slice(),this._sampling=n.slice(),this._energy=r,this._wavelength=e(r),this._semiangle_cutoff=i,this._defocus=o}_get_scattering_angles(){let e=t(this._gpts[0],this._sampling[0]),o=t(this._gpts[1],this._sampling[1]),[a,l]=n(e,o);return[r.sqrt(r.add(a.multiply(a.multiply(this._wavelength*this._wavelength)),l.multiply(l.multiply(this._wavelength*this._wavelength)))),i(a,l)]}_evaluate_aberrations(e,t){let n=this._defocus/this._wavelength*Math.PI,i=e.multiply(e).multiply(n),a=r.cos(i),l=r.sin(i),s=new o(i.shape);return s.data=r.stack([a,l],-1),s}_evaluate_aperture(e,t){let n=this._semiangle_cutoff/1e3,i=new o(e.shape),l=a(e,n);return i.data=r.stack([l,r.zeros(e.shape)],-1),i}build(){let[e,t]=this._get_scattering_angles(),n=this._evaluate_aberrations(e,t),i=this._evaluate_aperture(e,t),a=n.multiply(i);this._fourier_array=a;let l=new o(a.shape);l.data=r.ifft(a.data);let s=Math.sqrt(l.abs_sqr().sum());return this._array=l.scalar_multiply(1/s,0),this}}}function en(e){return e`https://observablehq.com/@mootari/notebook-data`}function tn(e,t){const n=e.module();return n.variable(t()).define(["md"],Nt),n.variable(t()).define(["htl"],Tt),n.variable(t("nj")).define("nj",["require"],Bt),n.variable(t("ops")).define("ops",["require"],Ot),n.variable(t("cops")).define("cops",["require"],Vt),n.variable(t("atan2")).define("atan2",["nj","ops"],Xt),n.variable(t("lt_int_s")).define("lt_int_s",["nj","ops"],Jt),n.variable(t("ComplexNDArray")).define("ComplexNDArray",["nj","atan2","cops"],Qt),n.variable(t("fftfreq")).define("fftfreq",["nj"],Yt),n.variable(t("meshgrid2D")).define("meshgrid2D",["nj"],Lt),n.variable(t("fftshift2D")).define("fftshift2D",["nj"],Ut),n.variable(t("fourier_shift")).define("fourier_shift",["ComplexNDArray","nj","fftfreq","meshgrid2D"],Ft),n.variable(t("corner_crop")).define("corner_crop",["ComplexNDArray"],Kt),n.variable(t("fourier_downsample")).define("fourier_downsample",["ComplexNDArray","nj","corner_crop"],Wt),n.variable(t("electron_wavelength_angstroms")).define("electron_wavelength_angstroms",Ht),n.variable(t("electron_interaction_parameter")).define("electron_interaction_parameter",["electron_wavelength_angstroms"],Zt),n.variable(t("ComplexProbe")).define("ComplexProbe",["electron_wavelength_angstroms","fftfreq","meshgrid2D","nj","atan2","ComplexNDArray","lt_int_s"],$t),n.variable(t()).define(["md"],en),n}function nn(e){return e`# Projection Set Algorithms

Here, we will illustrate another very powerful non-convex optimization strategy used in ptychograghy, called "projection set methods".`}function rn(e){return e`## Alternating Projections

Suppose we want to find the solution at the intersection of two sets:
1. a set of all points lying on the red line, and
2. a set of all point lying on the blue line.

Seems simple right? The catch is that we're only allowed to operate on one set at a time. A simple idea could be to take alternating steps where we "project" on one of the sets.

_Note:_ By "project" here we mean finding the closest point between our current location that lies on the set.

Let's try it!`}function on(e){return e.range([50,1e3],{value:200,step:25,label:"Animation speed [ms]"})}function an(e){return e.checkbox(["iterate","reset"],{value:[]})}function ln(e,t){return e.plot({x:{axis:!1,domain:[-.5,9/8]},y:{axis:!1,domain:[-1/4,.5]},aspectRatio:1,style:{background:"none"},marks:[e.line([{x:-.5,y:-1/4,set:1,col:"red"},{x:9/8,y:9/16,set:1,col:"red"},{x:-.5,y:-1/16,set:2,col:"blue"},{x:9/8,y:9/64,set:2,col:"blue"}],{x:"x",y:"y",z:"set",stroke:"col"}),e.line(t,{stroke:"orange"}),e.dot(t,{fill:"orange",fillOpacity:.5,r:10})]})}function sn(e){return e`## Non-Convex Sets?

The above example was rather easy, since both our sets were convex. What do you think will happen for non-convex sets? E.g. two disconnected half-lines. Well, our naive alternating projection algorithm will get stuck!`}function cn(e){return e.checkbox(["iterate","reset"],{value:[]})}function un(e,t){return e.plot({x:{axis:!1,domain:[-.5,9/8]},y:{axis:!1,domain:[-1/4,.5]},aspectRatio:1,style:{background:"none"},marks:[e.line([{x:-.5,y:-1/4,set:1,col:"red"},{x:1/4,y:1/8,set:1,col:"red"},{x:.5,y:1/4,set:2,col:"red"},{x:9/8,y:9/16,set:2,col:"red"},{x:-.5,y:-1/16,set:3,col:"blue"},{x:1/4,y:1/32,set:3,col:"blue"},{x:.5,y:1/16,set:4,col:"blue"},{x:9/8,y:9/64,set:4,col:"blue"}],{x:"x",y:"y",z:"set",stroke:"col"}),e.line(t,{stroke:"orange"}),e.dot(t,{fill:"orange",fillOpacity:.5,r:10})]})}function _n(e){return e`## Generalized Projections

Turns out, we don't just have to "project" to the set exactly - we can also e.g. reflect about the set to allow for a wide search-space. More generally, we can define a "family" of generalized projection set algorithms according to the iteration:`}function fn(e){return e.block`
x_{k+1} \leftarrow \left(1-a-b \right)x_k + a \Pi_1 \left[x_k\right] + b \Pi_2 \left[c \Pi[x_k]+\left(1-c\right)x_k \right]
`}function dn(e,t){return t`For scalar parameters ${e`(a,b,c)`}.

Some named choices include:
- Alternating Projections (AP): ${e`(a=0,b=1,c=1)`}
- Difference Map (DM): ${e`(a=-1,b=1,c=2)`}
- Relax Reflect Reflect (RRR): ${e`(a=-\gamma,b=\gamma,c=2)`}
- Relaxed Averaged Alternating Reflections (RAAR): ${e`(a=1-2\gamma,b=\gamma,c=2)`}`}function pn(e){return e.form({projection_name:e.radio(["AP","DM","RRR","RAAR","Generalized"],{value:"AP",label:"projection"}),projection_gamma:e.range([0,1],{value:.875,step:.001,label:"relaxation \u03b3"})})}function vn(e,t,n){return e.form({projection_a:e.range([-1,1],{value:`${"Generalized"==t.projection_name?0:n[t.projection_name].a}`,step:.001,label:"parameter a"}),projection_b:e.range([0,2],{value:`${"Generalized"==t.projection_name?1:n[t.projection_name].b}`,step:.001,label:"parameter b"}),projection_c:e.range([0,2],{value:`${"Generalized"==t.projection_name?1:n[t.projection_name].c}`,step:.001,label:"parameter c"})})}function hn(e,t){return t`## Multiple Sets

In general, our algorithm above relies on only two generalized projections. When we have more than two sets, we need to reformulate our constraints in the form above. 

A simple way to do this is to apply our projections on a copy of the current iterate separately (${e`\Pi_1`} above), and then average our points together (${e`\Pi_2`} above).`}function mn(e){return e.checkbox(["iterate","reset"],{value:[]})}function bn(e,t,n){let r=[...Array(e.shape[0])].map(((t,n)=>({x:e.get(n,0),y:e.get(n,1),set:5,col:"green"}))),i=t.map((e=>e.reduce(((e,t)=>[e[0]+t[0],e[1]+t[1]])).map((t=>t/e.length))));return n.plot({x:{axis:!1,domain:[-.5,9/8]},y:{axis:!1,domain:[-1/4,.5]},aspectRatio:1,style:{background:"none"},marks:[n.line([{x:-.5,y:-1/4,set:1,col:"red"},{x:1/4,y:1/8,set:1,col:"red"},{x:.5,y:1/4,set:2,col:"red"},{x:9/8,y:9/16,set:2,col:"red"},{x:-.5,y:-1/16,set:3,col:"blue"},{x:1/4,y:1/32,set:3,col:"blue"},{x:.5,y:1/16,set:4,col:"blue"},{x:9/8,y:9/64,set:4,col:"blue"},...r],{x:"x",y:"y",z:"set",stroke:"col"}),n.line(i,{stroke:"orange"}),n.dot(i,{fill:"orange",fillOpacity:.5,r:10})]})}function gn(e){return e.html`<hr class="hideable-md">`}function xn(e){return{AP:{a:0,b:1,c:1},DM:{a:-1,b:1,c:2},RRR:{a:-e.projection_gamma,b:e.projection_gamma,c:2},RAAR:{a:1-2*e.projection_gamma,b:e.projection_gamma,c:2}}}function wn(e){let t=e.arange(0,2*Math.PI,Math.PI/512),n=[-5/4*Math.cos(Math.PI/8),-5/4*Math.sin(Math.PI/8)],r=e.sin(t.multiply(4)).divide(4).add(1),i=r.multiply(e.cos(t)).subtract(n[0]).divide(3),o=r.multiply(e.sin(t)).subtract(n[1]).divide(3);return e.stack([i,o],-1)}function jn(){return function(e){let[t,n]=e;return[.4*(2*t+n),(2*t+n)/5]}}function yn(){return function(e){let[t,n]=e;return[32/65*(2*t+n/4),4/65*(2*t+n/4)]}}function kn(){return function(e){let[t,n]=e;if(8*t+4*n>=5||2*t+n<=5/8){let e=(2*t+n)/5;return[2*e,e]}if(15/16<2*t+n&&2*t+n<5/4)return[.5,1/4];if(2*t+n>5/8)return[1/4,1/8];{let e=2*n/5+4*t/5-1/8;return[2*e,e]}}}function An(){return function(e){let[t,n]=e;if(8*t+n>=65/16||8*t+n<=65/32){let e=(8*t+n)/65;return[8*e,e]}if(195/64<8*t+n&&t+n<65/16)return[.5,1/16];if(8*t+n>=65/32)return[1/4,1/32];{let e=2*n/65+16*t/64-1/32;return[8*e,e]}}}function Pn(e,t){return function(n){let[r,i]=n,o=e.add(t.pick(null,0).subtract(r).pow(2),t.pick(null,1).subtract(i).pow(2)).tolist().reduce(((e,t,n,r)=>t>r[e]?e:n),-1);return[t.get(o,0),t.get(o,1)]}}function Rn(){return function(e,t,n){let[r,i,o]=n,a=1-r-i,l=1-o;return function(n){let[s,c]=n,[u,_]=e([s,c]),[f,d]=t([o*u+l*s,o*_+l*c]);return[a*s+r*u+i*f,a*c+r*_+i*d]}}}function In(){return function(e,t,n){return function(r){let[[i,o],[a,l],[s,c]]=r;return[e([i,o]),t([a,l]),n([s,c])]}}}function zn(){return function(e){let[[t,n],[r,i],[o,a]]=e,l=(t+r+o)/3,s=(n+i+a)/3;return[[l,s],[l,s],[l,s]]}}function Mn(e,t){return function(n,r,i,o){let[a,l,s]=o,c=1-a-l,u=1-s,_=e(n,r,i),f=t;return function(e){let[[t,n],[r,i],[o,d]]=e,[[p,v],[h,m],[b,g]]=_([[t,n],[r,i],[o,d]]),[[x,w],[j,y],[k,A]]=f([[s*p+u*t,s*v+u*n],[s*h+u*r,s*m+u*i],[s*b+u*o,s*g+u*d]]);return[[c*t+a*p+l*x,c*n+a*v+l*w],[c*r+a*h+l*j,c*i+a*m+l*y],[c*o+a*b+l*k,c*d+a*g+l*A]]}}}function qn(e,t,n,r){return e(t,n,[r.projection_a,r.projection_b,r.projection_c])}function Dn(e,t,n,r){return e(t,n,[r.projection_a,r.projection_b,r.projection_c])}function Cn(e,t,n,r,i){return e(t,n,r,[i.projection_a,i.projection_b,i.projection_c])}function Sn(){return[[1,.3]]}function En(){return[[1,.3]]}function Gn(){return[[[1,.3],[1,.3],[1,.3]]]}function Nn(e,t){e.includes("reset")&&(t.value=[[1,.3]])}function*Tn(e,t,n,r,i,o){let a=0;for(;e.includes("iterate");){yield t.tick(n,++a);let e=r.length;i.value=[...r,o(r[e-1])]}}function Bn(e,t){e.includes("reset")&&(t.value=[[1,.3]])}function*On(e,t,n,r,i,o){let a=0;for(;e.includes("iterate");){yield t.tick(n,++a);let e=r.length;i.value=[...r,o(r[e-1])]}}function Vn(e,t){e.includes("reset")&&(t.value=[[[1,.3],[1,.3],[1,.3]]])}function*Xn(e,t,n,r,i,o){let a=0;for(;e.includes("iterate");){yield t.tick(n,++a);let e=r.length;i.value=[...r,o(r[e-1])]}}function Jn(e,t){const n=e.module();n.variable(t()).define(["md"],nn),n.variable(t()).define(["md"],rn),n.variable(t("viewof animation_speed")).define("viewof animation_speed",["Inputs"],on),n.variable(t("animation_speed")).define("animation_speed",["Generators","viewof animation_speed"],((e,t)=>e.input(t))),n.variable(t("viewof iterate_convex")).define("viewof iterate_convex",["Inputs"],an),n.variable(t("iterate_convex")).define("iterate_convex",["Generators","viewof iterate_convex"],((e,t)=>e.input(t))),n.variable(t("two_convex_sets_plot")).define("two_convex_sets_plot",["Plot","iteration_pts_convex"],ln),n.variable(t()).define(["md"],sn),n.variable(t("viewof iterate_nonconvex")).define("viewof iterate_nonconvex",["Inputs"],cn),n.variable(t("iterate_nonconvex")).define("iterate_nonconvex",["Generators","viewof iterate_nonconvex"],((e,t)=>e.input(t))),n.variable(t("two_nonconvex_sets_plot")).define("two_nonconvex_sets_plot",["Plot","iteration_pts_nonconvex"],un),n.variable(t()).define(["md"],_n),n.variable(t()).define(["tex"],fn),n.variable(t()).define(["tex","md"],dn),n.variable(t("viewof projection_inputs_a")).define("viewof projection_inputs_a",["Inputs"],pn),n.variable(t("projection_inputs_a")).define("projection_inputs_a",["Generators","viewof projection_inputs_a"],((e,t)=>e.input(t))),n.variable(t("viewof projection_inputs_b")).define("viewof projection_inputs_b",["Inputs","projection_inputs_a","named_projection_parameters"],vn),n.variable(t("projection_inputs_b")).define("projection_inputs_b",["Generators","viewof projection_inputs_b"],((e,t)=>e.input(t))),n.variable(t()).define(["tex","md"],hn),n.variable(t("viewof iterate_flower")).define("viewof iterate_flower",["Inputs"],mn),n.variable(t("iterate_flower")).define("iterate_flower",["Generators","viewof iterate_flower"],((e,t)=>e.input(t))),n.variable(t("flower_sets_plot")).define("flower_sets_plot",["flower_values","iteration_pts_flower","Plot"],bn),n.variable(t()).define(["htl"],gn);const r=e.module(tn);return n.import("nj",r),n.variable(t("named_projection_parameters")).define("named_projection_parameters",["projection_inputs_a"],xn),n.variable(t("flower_values")).define("flower_values",["nj"],wn),n.variable(t("region_nearest_convex_red")).define("region_nearest_convex_red",jn),n.variable(t("region_nearest_convex_blue")).define("region_nearest_convex_blue",yn),n.variable(t("region_nearest_nonconvex_red")).define("region_nearest_nonconvex_red",kn),n.variable(t("region_nearest_nonconvex_blue")).define("region_nearest_nonconvex_blue",An),n.variable(t("region_nearest_flower_green")).define("region_nearest_flower_green",["nj","flower_values"],Pn),n.variable(t("generalized_projection")).define("generalized_projection",Rn),n.variable(t("product_space_projection")).define("product_space_projection",In),n.variable(t("diagonal_projection")).define("diagonal_projection",zn),n.variable(t("generalized_projection_multiple")).define("generalized_projection_multiple",["product_space_projection","diagonal_projection"],Mn),n.variable(t("two_convex_sets")).define("two_convex_sets",["generalized_projection","region_nearest_convex_red","region_nearest_convex_blue","projection_inputs_b"],qn),n.variable(t("two_nonconvex_sets")).define("two_nonconvex_sets",["generalized_projection","region_nearest_nonconvex_red","region_nearest_nonconvex_blue","projection_inputs_b"],Dn),n.variable(t("three_nonconvex_sets")).define("three_nonconvex_sets",["generalized_projection_multiple","region_nearest_nonconvex_red","region_nearest_nonconvex_blue","region_nearest_flower_green","projection_inputs_b"],Cn),n.define("initial iteration_pts_convex",Sn),n.variable(t("mutable iteration_pts_convex")).define("mutable iteration_pts_convex",["Mutable","initial iteration_pts_convex"],((e,t)=>new e(t))),n.variable(t("iteration_pts_convex")).define("iteration_pts_convex",["mutable iteration_pts_convex"],(e=>e.generator)),n.define("initial iteration_pts_nonconvex",En),n.variable(t("mutable iteration_pts_nonconvex")).define("mutable iteration_pts_nonconvex",["Mutable","initial iteration_pts_nonconvex"],((e,t)=>new e(t))),n.variable(t("iteration_pts_nonconvex")).define("iteration_pts_nonconvex",["mutable iteration_pts_nonconvex"],(e=>e.generator)),n.define("initial iteration_pts_flower",Gn),n.variable(t("mutable iteration_pts_flower")).define("mutable iteration_pts_flower",["Mutable","initial iteration_pts_flower"],((e,t)=>new e(t))),n.variable(t("iteration_pts_flower")).define("iteration_pts_flower",["mutable iteration_pts_flower"],(e=>e.generator)),n.variable(t("two_convex_sets_reset")).define("two_convex_sets_reset",["iterate_convex","mutable iteration_pts_convex"],Nn),n.variable(t("two_convex_sets_generator")).define("two_convex_sets_generator",["iterate_convex","Promises","animation_speed","iteration_pts_convex","mutable iteration_pts_convex","two_convex_sets"],Tn),n.variable(t("two_nonconvex_sets_reset")).define("two_nonconvex_sets_reset",["iterate_nonconvex","mutable iteration_pts_nonconvex"],Bn),n.variable(t("two_nonconvex_sets_generator")).define("two_nonconvex_sets_generator",["iterate_nonconvex","Promises","animation_speed","iteration_pts_nonconvex","mutable iteration_pts_nonconvex","two_nonconvex_sets"],On),n.variable(t("flower_sets_reset")).define("flower_sets_reset",["iterate_flower","mutable iteration_pts_flower"],Vn),n.variable(t("flower_sets_generator")).define("flower_sets_generator",["iterate_flower","Promises","animation_speed","iteration_pts_flower","mutable iteration_pts_flower","three_nonconvex_sets"],Xn),n}function Qn(e){return e}function Yn(e){return e}function Ln(e){return e}function Un(e){return e}function Fn(e){return e.html`<hr class="hideable-md" >`}function Kn(e){return e}function Wn(e){return e}function Hn(e,t){const n=e.module();n.variable(t()).define(["viewof iterate_flower"],Qn),n.variable(t()).define(["flower_sets_plot"],Yn),n.variable(t()).define(["viewof projection_inputs_a"],Ln),n.variable(t()).define(["viewof projection_inputs_b"],Un),n.variable(t()).define(["htl"],Fn);const r=e.module(Jn);return n.import("viewof iterate_flower",r),n.import("iterate_flower",r),n.import("flower_sets_plot",r),n.import("flower_sets_generator",r),n.import("flower_sets_reset",r),n.import("viewof projection_inputs_a",r),n.import("projection_inputs_a",r),n.import("viewof projection_inputs_b",r),n.import("projection_inputs_b",r),n.variable(t()).define(["flower_sets_generator"],Kn),n.variable(t()).define(["flower_sets_reset"],Wn),n}const Zn=function(){const e=(0,l.useRef)();return(0,l.useEffect)((()=>{const t=new s.Runtime;return t.module(Hn,s.Inspector.into(e.current)),()=>t.dispose()}),[]),(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{ref:e})})},$n=n.p+"assets/images/sudoku-frame-purple-01-453d8f5261524156150eed6d26d04c29.png",er=n.p+"assets/images/sudoku-frame-purple-02-611c1101b3cc457335afb48dd41e759b.png",tr=n.p+"assets/images/sudoku-frame-purple-03-865cc6d86ed1a03f1fbc79030112339c.png",nr=n.p+"assets/images/sudoku-frame-purple-04-5934855310e6b7d8327d3ace4fd23074.png",rr=n.p+"assets/images/sudoku-frame-purple-05-fe852317fa0a06b6724a62fcbfbecabc.png",ir=n.p+"assets/images/sudoku-frames-purple-infinite-a13b0615ed034eddcd9a332b8538f983.gif";var or=n(84818);const ar={id:"ptycho-back_projections",sidebar_position:2,title:"Proximal Gradient Methods",hide_table_of_contents:!0,hide_title:!0},lr=void 0,sr={id:"ptycho-back/ptycho-back_projections",title:"Proximal Gradient Methods",description:"Proximal Gradient Methods",source:"@site/slides/ptycho-back/ptycho-back_projections.mdx",sourceDirName:"ptycho-back",slug:"/ptycho-back/ptycho-back_projections",permalink:"/2024msi-presentation/slides/ptycho-back/ptycho-back_projections",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{id:"ptycho-back_projections",sidebar_position:2,title:"Proximal Gradient Methods",hide_table_of_contents:!0,hide_title:!0},sidebar:"tutorialSidebar",previous:{title:"4DSTEM",permalink:"/2024msi-presentation/slides/ptycho-back/ptycho-back_4dstem"},next:{title:"Electron Ptychography",permalink:"/2024msi-presentation/slides/ptycho-back/ptycho-back_epie"}},cr={},ur=[{value:"Proximal Gradient Methods",id:"proximal-gradient-methods",level:2}];function _r(e){const t={h2:"h2",li:"li",ul:"ul",...(0,i.useMDXComponents)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(or.default,{width:"240px",height:"60px",className:"outline-header"}),"\n",(0,r.jsx)(t.h2,{id:"proximal-gradient-methods",children:"Proximal Gradient Methods"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Proximal gradient methods are a powerful technique to solve non-convex inverse problems"}),"\n",(0,r.jsxs)(t.li,{children:["Problem: find the intersection of multiple (non-convex) sets (e.g. lines)","\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:'Catch: Only allowed to "operate" on only one set a time'}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(o.default,{Lazy:!0,children:[(0,r.jsx)(a.default,{value:"two-convex-sets",label:"Two Convex Sets",default:!0,children:(0,r.jsx)(we,{})}),(0,r.jsx)(a.default,{value:"two-nonconvex-sets",label:"Two Non-Convex Sets",children:(0,r.jsx)(Gt,{})}),(0,r.jsx)(a.default,{value:"multiple-sets",label:"Multiple Non-Convex Sets",children:(0,r.jsx)(Zn,{})}),(0,r.jsxs)(a.default,{value:"higher-dimensional-sets",label:"Sudoku Puzzles",children:[(0,r.jsxs)("ul",{children:[(0,r.jsx)("li",{children:" Constraint satisfaction problem:"}),(0,r.jsxs)("ul",{children:[(0,r.jsx)("li",{children:" Each row/column/3x3 block contains each of the numbers 1-9 "}),(0,r.jsx)("li",{children:" Solution must be consistent with a set of pre-defined clues"})]}),(0,r.jsx)("li",{children:" Each constraint \u2192 projection to a non-convex set "}),(0,r.jsx)("li",{children:" This can be solved using iterative proximal gradient algorithms: "}),(0,r.jsxs)("ul",{children:[(0,r.jsx)("li",{children:" Given a randomly-generated grid"}),(0,r.jsx)("li",{children:" Apply each projection independently"}),(0,r.jsx)("li",{children:" Average independent projections"}),(0,r.jsx)("li",{children:" Rinse and repeat, until convergence"})]})]}),(0,r.jsxs)(o.default,{children:[(0,r.jsx)(a.default,{value:"iteration 01",label:"iteration 01",default:!0,children:(0,r.jsx)("figure",{children:(0,r.jsx)("img",{src:$n,alt:"Sudoku Solution 01",width:"100%",height:"auto"})})}),(0,r.jsx)(a.default,{value:"iteration 02",label:"iteration 02",children:(0,r.jsx)("figure",{children:(0,r.jsx)("img",{src:er,alt:"Sudoku Solution 02",width:"100%",height:"auto"})})}),(0,r.jsx)(a.default,{value:"iteration 03",label:"iteration 03",children:(0,r.jsx)("figure",{children:(0,r.jsx)("img",{src:tr,alt:"Sudoku Solution 03",width:"100%",height:"auto"})})}),(0,r.jsx)(a.default,{value:"iteration 04",label:"iteration 04",children:(0,r.jsx)("figure",{children:(0,r.jsx)("img",{src:nr,alt:"Sudoku Solution 04",width:"100%",height:"auto"})})}),(0,r.jsx)(a.default,{value:"iteration 05",label:"iteration 05",children:(0,r.jsx)("figure",{children:(0,r.jsx)("img",{src:rr,alt:"Sudoku Solution 05",width:"100%",height:"auto"})})}),(0,r.jsx)(a.default,{value:"solution gif",label:"animated solution",children:(0,r.jsx)("figure",{children:(0,r.jsx)("img",{src:ir,alt:"Sudoku Solution GIF",width:"100%",height:"auto"})})})]})]})]})]})}function fr(e={}){const{wrapper:t}={...(0,i.useMDXComponents)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(_r,{...e})}):_r(e)}},61187:(e,t,n)=>{var r={"./arquero.js":29391,"./arrow.js":57938,"./dependencies.js":67363,"./dependency.js":10170,"./dom/canvas.js":76342,"./dom/context2d.js":99733,"./dom/download.js":32938,"./dom/element.js":63380,"./dom/index.js":81820,"./dom/input.js":37585,"./dom/range.js":57170,"./dom/select.js":31106,"./dom/svg.js":55895,"./dom/text.js":30281,"./dom/uid.js":81831,"./duckdb.js":93874,"./fileAttachment.js":33277,"./files/buffer.js":43825,"./files/index.js":46155,"./files/text.js":9974,"./files/url.js":12174,"./generators/disposable.js":12238,"./generators/filter.js":7254,"./generators/index.js":26785,"./generators/input.js":28044,"./generators/map.js":33921,"./generators/observe.js":61367,"./generators/queue.js":49042,"./generators/range.js":52707,"./generators/valueAt.js":15890,"./generators/worker.js":8179,"./html.js":46566,"./index.js":7138,"./leaflet.js":53861,"./library.js":64739,"./md.js":21715,"./mermaid.js":98843,"./mutable.js":30221,"./now.js":3666,"./promises/delay.js":52984,"./promises/index.js":15898,"./promises/tick.js":22989,"./promises/when.js":37782,"./require.js":19204,"./resolve.js":95545,"./sqlite.js":64054,"./svg.js":54745,"./table.js":9669,"./template.js":19225,"./tex.js":40667,"./that.js":5243,"./vegalite.js":70423,"./width.js":10282,"./xlsx.js":40538};function i(e){return Promise.resolve().then((()=>{if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n(r[e])}))}i.keys=()=>Object.keys(r),i.id=61187,e.exports=i},84818:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});var r,i,o=n(67294);function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a.apply(this,arguments)}const l=e=>{let{title:t,titleId:n,...l}=e;return o.createElement("svg",a({fill:"currentColor",fontFamily:"system-ui, sans-serif",fontSize:10,textAnchor:"middle",width:800,height:200,viewBox:"0 0 800 200",id:"svg8",xmlnsXlink:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/2000/svg",style:{display:"block",background:"#fff",height:"intrinsic",maxWidth:"100%"},"aria-labelledby":n},l),t?o.createElement("title",{id:n},t):null,r||(r=o.createElement("style",{id:"style2"})),i||(i=o.createElement("g",{"aria-label":"raster",id:"g6",transform:"translate(0 -100.25)"},o.createElement("image",{transform:"matrix(1 0 0 -1 .5 400)",width:799,height:399.5,preserveAspectRatio:"none",xlinkHref:"data:image/png;base64,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",id:"image4"}))))}},85162:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});n(67294);var r=n(90512);const i={tabItem:"tabItem_Ymn6"};var o=n(85893);function a(e){let{children:t,hidden:n,className:a}=e;return(0,o.jsx)("div",{role:"tabpanel",className:(0,r.default)(i.tabItem,a),hidden:n,children:t})}},74866:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>j});var r=n(67294),i=n(90512),o=n(12466),a=n(16550),l=n(20469),s=n(91980),c=n(67392),u=n(50012);function _(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function f(e){const{values:t,children:n}=e;return(0,r.useMemo)((()=>{const e=t??function(e){return _(e).map((e=>{let{props:{value:t,label:n,attributes:r,default:i}}=e;return{value:t,label:n,attributes:r,default:i}}))}(n);return function(e){const t=(0,c.duplicates)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function d(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function p(e){let{queryString:t=!1,groupId:n}=e;const i=(0,a.useHistory)(),o=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,s.useQueryStringValue)(o),(0,r.useCallback)((e=>{if(!o)return;const t=new URLSearchParams(i.location.search);t.set(o,e),i.replace({...i.location,search:t.toString()})}),[o,i])]}function v(e){const{defaultValue:t,queryString:n=!1,groupId:i}=e,o=f(e),[a,s]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!d({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const r=n.find((e=>e.default))??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:o}))),[c,_]=p({queryString:n,groupId:i}),[v,h]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[i,o]=(0,u.useStorageSlot)(n);return[i,(0,r.useCallback)((e=>{n&&o.set(e)}),[n,o])]}({groupId:i}),m=(()=>{const e=c??v;return d({value:e,tabValues:o})?e:null})();(0,l.default)((()=>{m&&s(m)}),[m]);return{selectedValue:a,selectValue:(0,r.useCallback)((e=>{if(!d({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);s(e),_(e),h(e)}),[_,h,o]),tabValues:o}}var h=n(72389);const m={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=n(85893);function g(e){let{className:t,block:n,selectedValue:r,selectValue:a,tabValues:l}=e;const s=[],{blockElementScrollPositionUntilNextRender:c}=(0,o.useScrollPositionBlocker)(),u=e=>{const t=e.currentTarget,n=s.indexOf(t),i=l[n].value;i!==r&&(c(t),a(i))},_=e=>{let t=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const n=s.indexOf(e.currentTarget)+1;t=s[n]??s[0];break}case"ArrowLeft":{const n=s.indexOf(e.currentTarget)-1;t=s[n]??s[s.length-1];break}}t?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.default)("tabs",{"tabs--block":n},t),children:l.map((e=>{let{value:t,label:n,attributes:o}=e;return(0,b.jsx)("li",{role:"tab",tabIndex:r===t?0:-1,"aria-selected":r===t,ref:e=>s.push(e),onKeyDown:_,onClick:u,...o,className:(0,i.default)("tabs__item",m.tabItem,o?.className,{"tabs__item--active":r===t}),children:n??t},t)}))})}function x(e){let{lazy:t,children:n,selectedValue:i}=e;const o=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=o.find((e=>e.props.value===i));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:o.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==i})))})}function w(e){const t=v(e);return(0,b.jsxs)("div",{className:(0,i.default)("tabs-container",m.tabList),children:[(0,b.jsx)(g,{...e,...t}),(0,b.jsx)(x,{...e,...t})]})}function j(e){const t=(0,h.default)();return(0,b.jsx)(w,{...e,children:_(e.children)},String(t))}}}]);